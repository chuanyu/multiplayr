<html>
<head>
	<title>Test</title>
</head>
<body>
	Test cases<br />
	----------<br />
	<br />
	Please open the console
	<script src="/socket.io/socket.io.js"></script>
	<script src="/js/mp.transport.js"></script>

	<script>
	// This only works because this is the last script tag. All libraries should
	// 1. load before this
	// 2. not load on document.onready

	function assert(exp) {
		if (!exp) {
			throw new Error();
		}
	}

	function test1() {
		m1 = new Mesh(io, 'http://localhost:8080');
		m2 = new Mesh(io, 'http://localhost:8080');

		m2.on('message', function (data) {
			assert(data.message === "HELLO");
		});

		m1.create(function(err, data) {
                    if (err) {
                        throw new Error();
                    } else {
			m2.join(data.roomId, function (data) {
				// TODO: Create an event handler when peers are received
				setTimeout(function () {
					assert(m2.peers.indexOf(m1.clientId) !== -1);
					m1.send(m2.clientId, "HELLO");
				}, 100);
			});
                    }
                });
	}

	test1();
	</script>
</body>
